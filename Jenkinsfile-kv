pipeline {
    agent any

    options {
        ansiColor('xterm')
    }

    environment {
        // Archivo secreto con configuraci√≥n en formato JSON
        JOHN_SECRET = credentials('john-secret-kv') // ID de la credencial Azure Key Vault
    }

    stages {
        stage('Login en Azure') {
            steps {
                withCredentials([azureServicePrincipal(credentialsId: 'credentials_id')]) {
                    sh '''
                        echo "Autenticando en Azure..."
                        az login --service-principal \
                            -u "$AZURE_CLIENT_ID" \
                            -p "$AZURE_CLIENT_SECRET" \
                            --tenant "$AZURE_TENANT_ID"

                        az account set --subscription "$AZURE_SUBSCRIPTION_ID"
                    '''
                }
            }
        }

        stage('Leer secreto de Azure Key Vault') {
            steps {
                sh '''
                    echo "Mostrando JSON formateado:"
                    echo "$JOHN_SECRET" | jq .
                '''
            }
        }
    }
}